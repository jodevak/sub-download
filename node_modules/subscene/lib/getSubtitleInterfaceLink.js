var langCodes=require('./langCodes.js');
var request = require('request');
var $=require('cheerio');
/////////important settings for network optimization and solving stuck///////////////
var trial=0;
var trial_limit=10;
var delay_between_each_trial=1000;
var time_out_request=4000;
///////////////////////////////
function getSubtitleInterfaceLink(link,lang,callback){

request({
  url: link+"/"+lang,
  timeout:time_out_request,
  maxSockets:100,
  headers: {

    'User-Agent': 'Mozilla/5.0',
    'Cookie':'LanguageFilter='+langCodes[lang]

  }
}, function (error, response, body) {

if(!error && response.statusCode === 200 ) {
    var ch = $.load(body);
  var subLink="http://subscene.com"+ch('td.a1').eq(0).children('a').attr('href');
  callback(false,subLink);
}
else{



if(trial===trial_limit){
callback(true);
return;
}
trial=trial+1;

setTimeout(function () {
getSubtitleInterfaceLink(link,lang,callback);
return;
}, delay_between_each_trial);

}

});


};





module.exports=getSubtitleInterfaceLink;
