var request = require('request');
var $=require('cheerio');
/////////important settings for network optimization and solving stuck///////////////
var trial=0;
var trial_limit=15;
var delay_between_each_trial=2000;
var time_out_request=6000
///////////////////////////////
function scrapDownloadLink(subLink,callback){
  request({
    url: subLink,
    maxSockets:300,
    timeout:time_out_request,
    headers: {

      'User-Agent': 'Mozilla/5.0'

    }
  }, function (error, response, body) {
    if(!error && response.statusCode === 200){
    var ch = $.load(body);
    var downloadLink='http://subscene.com'+ch('#downloadButton').attr('href');
      callback(false,downloadLink);


}
else{
  if(subLink==='http://subscene.comundefined'){
    callback(true);
  }

  if(trial===trial_limit){
  callback(true);
}
trial=trial+1;
setTimeout(function () {


scrapDownloadLink(subLink,callback);
return;
}, delay_between_each_trial);
}

}


)

};

module.exports=scrapDownloadLink;
